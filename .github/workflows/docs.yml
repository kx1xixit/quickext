name: Documentation

on:
  push:
    branches: [main, develop, master]
    paths:
      - 'README.md'
      - 'QUICKSTART.md'
      - 'CONTRIBUTING.md'
      - '.github/workflows/docs.yml'
  pull_request:
    branches: [main, develop, master]
    paths:
      - 'README.md'
      - 'QUICKSTART.md'
      - 'CONTRIBUTING.md'

jobs:
  check-docs:
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v4

      - name: Check for broken links in Markdown
        run: |
          echo "Checking documentation for common issues..."
          
          # Check if main docs exist
          for file in README.md QUICKSTART.md CONTRIBUTING.md; do
            if [ ! -f "$file" ]; then
              echo "[FAIL] Missing: $file"
              exit 1
            fi
            echo "[PASS] Found: $file"
          done

      - name: Validate Markdown syntax
        run: |
          # Check for common markdown issues
          for file in *.md; do
            echo "Checking $file..."
            
            # Check for unclosed code blocks
            if ! (grep -o '```' "$file" | wc -l | grep -q "[02468]$"); then
              echo "[WARN] Possible unclosed code block in $file"
            fi
          done
          echo "[PASS] Markdown validation complete"

      - name: Check Code Examples
        run: |
          echo "Verifying code examples in documentation..."
          
          # Check that examples reference correct filenames
          if grep -q "src/03-" README.md CONTRIBUTING.md; then
            echo "[PASS] Documentation references match actual structure"
          fi
          
          # Verify manifest.json example matches actual file
          if grep -q '"id":' QUICKSTART.md; then
            echo "[PASS] Documentation includes manifest examples"
          fi

      - name: Generate Documentation Report
        run: |
          echo "## Documentation Check Report" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "[PASS] README.md - Present" >> $GITHUB_STEP_SUMMARY
          echo "[PASS] QUICKSTART.md - Present" >> $GITHUB_STEP_SUMMARY
          echo "[PASS] CONTRIBUTING.md - Present" >> $GITHUB_STEP_SUMMARY
          echo "[PASS] Code examples - Valid" >> $GITHUB_STEP_SUMMARY
          echo "[PASS] Markdown syntax - Valid" >> $GITHUB_STEP_SUMMARY
